---
title: "Hector User Guide"
author: "Ben Bond-Lamberty and Corinne Hartin"
date: "April 30, 2014"
output: html_document
---

Introduction: Hector
==============================
Introduction: Hector

Crediting and using Hector
==============================
License. TODO.

Citations. TODO.

Installing and building Hector
==============================
Installing and building

Precompiled binaries
---------------------------------
Precompiled binaries?

* MD5 checksums

Installing and building - all platforms
---------------------------------
Hector relies on several libraries, all of which are freely available
under a GPL or similar license. In order to build and run Hector, you
will need to download and install these libraries on your system. These include:

* *REQUIRED*: Boost. Free peer-reviewed portable C++ source libraries, available at http://www.boost.org/. 
Hector uses only the parts of Boost that are implemented as header libraries (i.e., all of the code is 
contained in header files that are included and compiled with the Hector source). Therefore, all you need to 
do to set up Boost is to download and extract it. Hector has been tested with Boost version 1_45_0.

* *REQUIRED*: Gnu Scientific Library. A numerical library for C and C++, available at http://www.gnu.org/software/gsl/. 
You will need to download and follow the Boost README instructions. Hector has been tested with GSL version 1.16.

* *OPTIONAL*: Googletest framework. TODO.

Installing and building - Mac OS X
---------------------------------
Installing and building - Mac OS X

Installing and building - Windows
---------------------------------
Installing and building - Windows

Installing and building - Linux
---------------------------------
The Hector makefiles look for the required libraries (above) in certain default
locations, but those defaults can be overridden by setting the
environment variables described below.

### Boost
Hector uses only the parts of Boost that are implemented as header
libraries (i.e., all of the code is contained in header files that are
included and compiled with the Hector source; you do not need to link
to any precompiled libraries). Therefore, all you need to do to set
up Boost is to download it and extract it from its tar file. 

Environment variables:

* BOOSTVERSION (default: `1_45_0`). The Boost version will appear in the name of the tar file you downloaded. It is used only to determine the default installation
directory (see below). If you override the default installation
directory, then you can ignore this variable

* BOOSTROOT (default `$(HOME)/src/boost_$(BOOSTVERSION)`).
This variable should contain the full name of the directory created
when you unpacked Boost. If you unpacked Boost in `$(HOME)/src`, then
all you need to do is set the BOOSTVERSION variable and leave this everything else
alone. If you unpacked it somewhere else, or if you changed the name
of the directory that was created when you unpacked it, then you will
need to set this variable explicitly.

### GNU Scientific Library (GSL)
You will need to compile and install the GSL. To do this, unpack the
GSL tar file in the location of your choice. Follow the setup
instructions in the GSL README file. Briefly, they comprise three
steps:  `./configure`, `make`, and `make install`. You will need to
have root (superuser) privilege to perform the last step, unless you
choose an install directory somewhere under your own home directory
(see the GSL README for instructions on how to do this). The default
install location is /usr/local, and that is also the default for
Hector. Therefore, if you use the GSL default installation procedure,
you will not need to override the Hector defaults. If you choose to
install GSL somewhere else, use the environment variable below to indicate
where you installed it.

Users running on the *Evergreen* computing system at PNNL need not
follow the procedure above to install the GSL; however, they must load
the GSL module by adding the following command to their login script:
`module load gsl`; then, see below for the correct environment
variable settings.

Environment variables:

* GSLROOT (default: `/usr/local`).
    Set this variable to the same install directory that you used when you
    configured GSL. **Exception**:  If you are running on the
    *Evergreen* computing system at PNNL, use the special string
    `EVERGREEN`. 

### Google Test Framework (gtest)
TODO

### Shared Library Search Path
Some of the libraries used by Hector (such as the GSL) will be
compiled into shared libraries that will loaded at run time. It is
best if these libraries are in directories that are part of your
system's shared library search path. On many systems `/usr/local` is
already in that path. If you install the libraries somewhere else,
you may need to add the installation directories to the list given in
`/etc/ld.so.conf`. Whether or not you install the GSL libraries in the default location, when you compile and install them 
you may need to refresh the library cache by running
`ldconfig` (which generally requires root privilege), or by rebooting your system 
(which does not).

If you are unable to add your library installation directory to the
library search path, you will need to add the installation directory
to the environment variable `LD_LIBRARY_PATH`.  Try not to use this approach if you 
can help it because it can cause some conflicts with other software on your system.
Instead, ask your system administrator if ldconfig is right for you.

### Building Hector
Once the necessary libraries are installed, change to the top-level
Hector directory and type `make hector`. The hector executable will
be built in the `source/` subdirectory. If you ever need to rebuild,
you can type `make clean` to clear away the executable and all of the
intermediate files.

There are two additional environment variables that you can use to
fine-tune the build process. The `CXXEXTRA` variable is passed to the
C++ compiler. You can use this variable to pass extra options to the
compiler without changing the Makefile. In particular, specifying
optimization options in `CXXEXTRA` such as -O or -O0 will override the
default value of -O3.

The `CXXPROF` variable is passed both to the compiler and the linker.
It is intended to turn on performance profiling, which must be
specified at both the compile and link stages of the build, so it
generally should be either unset (for normal operation) or set to -pg
(for profiling). Profiling slows the code down dramatically, so if you use it, be
sure to unset `CXXPROF` and rebuild when you are ready to go back to
production runs.

Installing and building - iOS/Android
---------------------------------
Not yet. ;)

Running Hector
==============================
Running Hector

Command-line options
---------------------------------
Command-line options

Input files and formats
---------------------------------
Input files and formats
Default RCP cases

Parameters and options (by component)



Output files
---------------------------------
Output files

Log files
---------------------------------
The model, and each of the model components, writes time-stamped diagnostics to files in the `logs/` directory. Each message has an associated severity level (DEBUG, NOTICE, WARNING, SEVERE); how much logging detail is written to a log can be changed at compile time (look for `logger.open` calls).

R backend
---------------------------------
R backend

Documentation and help
==============================
Documentation and help

* Code comments

* Doxygen

* This manual

* Published papers


Limitations and bugs
==============================
Limitations and bugs

See the `bugs/bugbase.csv` file for current (and past) Hector bugs. Note we will be transitioning to using the [Github](http://github.com) issue database.

Extending and changing Hector
==============================

Creating a new model component
---------------------------------
Add two new files:
       /trunk/headers/core/xcomponent.hpp
       /trunk/source/core/xcomponent.cpp
#include .hpp file in .cpp file

In avistor.hpp 
       Add class XComponent under the declarations of subclasses
	Add virtual void visit( XComponent*c ) {}

In core.cpp
	#include xcomponent.hpp
       Under init add:
		temp =  new XComponent();
       modelComponents[ temp-->getComponentName() ] = temp;

In component_names.hpp
	Under component names: #define X_COMPONENT_NAME “x”
	Under component capabilities: #define CAP_X  “x”

For example: if adding new components/classes to the forcing_component
	In forcing_component.hpp 
		#include xcomponent.hpp 
       Add IModelComponent* x;
	In forcing_component.cpp
		Under getData
			} else if( varName == “x” ) {
       returnval = forcings[ varName ];


Adding a new variable to a method
------------------------------------
using getData to obtain the information defined in the ini file

In hector.ini under the corresponding component add variable
	Ex: SN = 42000;
In hpp file of component add variable as unitval/double/etc. 
In component_names.hpp define the variables that are being added
	Ex: #define D_ATMOSPHERIC_SO2 "SN"
	These names do *not* have to match internal component variables but 
	the ini definition *has to* match what appears in quotes
In the component file .cpp 
	under init, need to register the Capability
	core->registerCapability( D_ATMOSPHERIC_SO2, getComponentName() );
In cpp file of component, under getData and setData, add the new variables in before the Error message 
	(getData)
	else if( varName == D_ATMOSPHERIC_SO2 ) {
       
	returnval = SN;
        
	(setData)
	else if( varName ==  D_ATMOSPHERIC_SO2  ) {
           
	H_ASSERT( valueIndex == Core::undefinedIndex() );
   
        SN.set( lexical_cast<double>( value ), U_GG );
        }
If this variable is called in another component.
	For example if adding in a variable within the focing component
        Ex: unitval SN = core->getData( D_ATMOSPHERIC_SO2, runToDate);

		
Code specifications and style
---------------------------------
See the `documentation/style.txt` file for Hector's code style guidelines.

Github
---------------------------------
Github

References
==============================
References

